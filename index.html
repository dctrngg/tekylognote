<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Form Báo Cáo Học Sinh</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />

  <style>
    /* ============== RESET + THEME ============== */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html,
    body {
      height: 100%;
    }

    body {
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      color: #1a1a1a;
      background: #fafafa;
      font-family: Inter, system-ui, sans-serif;
      line-height: 1.6;
    }

    /* ============== CONTAINER ============== */
    .wrapper {
      max-width: 900px;
      margin: 0 auto;
      padding: 40px 20px;
    }

    /* ============== HERO ============== */
    .hero {
      text-align: center;
      margin-bottom: 48px;
      padding: 24px 0;
    }

    .hero-headline {
      font-size: clamp(28px, 5vw, 36px);
      font-weight: 700;
      color: #1a1a1a;
      margin-bottom: 12px;
    }

    .hero-sub {
      font-size: 16px;
      color: #666;
      max-width: 600px;
      margin: 0 auto;
    }

    /* ============== CARD ============== */
    .card {
      background: #fff;
      border: 1px solid #e5e5e5;
      border-radius: 12px;
      padding: 32px;
      margin-bottom: 20px;
    }

    .card h2 {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 24px;
      color: #1a1a1a;
    }

    /* ============== FORM ============== */
    .form-group {
      margin-bottom: 20px;
    }

    .label {
      display: block;
      font-size: 14px;
      font-weight: 500;
      color: #333;
      margin-bottom: 6px;
    }

    .input,
    .textarea {
      width: 100%;
      padding: 10px 14px;
      border-radius: 8px;
      border: 1px solid #d4d4d4;
      background: #fff;
      color: #1a1a1a;
      outline: none;
      transition: border-color .2s, box-shadow .2s;
      font-family: inherit;
      font-size: 14px;
    }

    .textarea {
      resize: vertical;
      min-height: 80px;
    }

    .input:focus,
    .textarea:focus {
      border-color: #000;
      box-shadow: 0 0 0 3px rgba(0, 0, 0, .05);
    }

    .btn-group {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 10px 20px;
      font-weight: 500;
      font-size: 14px;
      border-radius: 8px;
      border: 1px solid #d4d4d4;
      background: #fff;
      color: #1a1a1a;
      cursor: pointer;
      transition: all .2s;
      font-family: inherit;
    }

    .btn:hover {
      background: #f5f5f5;
      border-color: #a3a3a3;
    }

    .btn:active {
      transform: translateY(1px);
    }

    .btn-primary {
      border-color: #000;
      background: #000;
      color: #fff;
    }

    .btn-primary:hover {
      background: #333;
      border-color: #333;
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* ============== OUTPUT ============== */
    .output {
      white-space: pre-wrap;
      line-height: 1.8;
      color: #1a1a1a;
      font-size: 14px;
      padding: 16px;
      background: #f9f9f9;
      border-radius: 8px;
      border: 1px solid #e5e5e5;
    }

    .success-msg {
      background: #f0fdf4;
      border: 1px solid #86efac;
      color: #166534;
      padding: 12px 16px;
      border-radius: 8px;
      font-size: 14px;
      margin-top: 16px;
      display: none;
    }

    .success-msg.show {
      display: block;
      animation: fadeIn .3s;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* ============== RESPONSIVE ============== */
    @media (max-width: 640px) {
      .wrapper {
        padding: 24px 16px;
      }

      .card {
        padding: 24px;
      }

      .btn-group {
        flex-direction: column;
      }

      .btn {
        width: 100%;
      }
    }
  </style>
</head>

<body>
  <div class="wrapper">
    <!-- Hero -->
    <section class="hero">
      <h1 class="hero-headline">Báo cáo buổi test</h1>
    </section>

    <!-- Form -->
    <div class="card">
      <h2>Thông tin buổi test</h2>
      <form id="reportForm">
        <div class="form-group">
          <label class="label" for="hoTen">Họ tên bé</label>
          <input class="input" type="text" id="hoTen" placeholder="VD: Nguyễn Văn A" required />
        </div>

        <div class="form-group">
          <label class="label" for="ngaySinh">Ngày tháng năm sinh</label>
          <input class="input" type="text" id="ngaySinh" placeholder="DD/MM/YYYY" inputmode="numeric"
            pattern="[0-9]{2}/[0-9]{2}/[0-9]{4}" required />
          <small class="label" style="font-size:12px;color:#666;margin-top:6px;display:block;">Nhập theo định dạng
            <strong>DD/MM/YYYY</strong></small>
        </div>

        <div class="form-group">
          <label class="label" for="truong">Trường đang học</label>
          <input class="input" type="text" id="truong" placeholder="VD: Trường Tiểu học ABC" required />
        </div>

        <div class="form-group">
          <label class="label" for="testMon">Test môn gì</label>
          <select class="input" id="testMon" required>
            <option value="">-- Chọn môn --</option>
            <option value="Mầm Non Công Nghệ">Mầm Non Công Nghệ</option>
            <option value="Khám phá Robotic">Khám phá Robotic</option>
            <option value="Bé làm Game">Bé làm Game</option>
            <option value="Siêu Nhân Lập Trình">Siêu Nhân Lập Trình</option>
            <option value="Digi SteamArt">Digi SteamArt</option>
            <option value="Digi Multimedia">Digi Multimedia</option>
            <option value="Thế Giới Vạn Vật Thông Minh">Thế Giới Vạn Vật Thông Minh</option>
          </select>
        </div>

        <div class="form-group">
          <label class="label" for="gvTest">GV test</label>
          <select class="input" id="gvTest" required>
            <option value="">-- Chọn giáo viên --</option>
            <option value="Nguyễn Hữu Luật">Nguyễn Hữu Luật</option>
            <option value="Nguyễn Đức Trung">Nguyễn Đức Trung</option>
            <option value="Trần Khắc Huân">Trần Khắc Huân</option>
            <option value="Trần Thị Phương Uyên">Trần Thị Phương Uyên</option>
            <option value="Nguyễn Thanh Ngọc">Nguyễn Thanh Ngọc</option>
            <option value="Nguyễn Hữu Tuấn Khang">Nguyễn Hữu Tuấn Khang</option>
            <option value="Võ Tấn Lộc">Võ Tấn Lộc</option>
          </select>
        </div>

        <div class="form-group">
          <label class="label" for="gvDanhGia">GV đánh giá bé học được từ HP mấy?</label>
          <select class="input" id="gvDanhGia" required>
            <option value="">-- Chọn --</option>
            <option value="Mầm Non Công Nghệ HP1 UARO">Mầm Non Công Nghệ HP1 UARO</option>
            <option value="Mầm Non Công Nghệ HP5 Scratch Jr">Mầm Non Công Nghệ HP5 Scratch Jr</option>
            <option value="Bé Làm Game HP1 Codekitten">Bé Làm Game HP1 Codekitten</option>
            <option value="Bé Làm Game HP5 Tynker">Bé Làm Game HP5 Tynker</option>
            <option value="Bé Làm Game HP7 Miniworld">Bé Làm Game HP7 Miniworld</option>
            <option value="Khám Phá Robotics AI HP1 Wedo">Khám Phá Robotics AI HP1 Wedo</option>
            <option value="Khám Phá Robotics AI HP5 Mindstorm">Khám Phá Robotics AI HP5 Mindstorm</option>
            <option value="Digi Steam Art HP1 Solidworks">Digi Steam Art HP1 Solidworks</option>
            <option value="Siêu Nhân Lập Trình HP1 Roblox">Siêu Nhân Lập Trình HP1 Roblox</option>
            <option value="Siêu Nhân Lập Trình HP5 Python">Siêu Nhân Lập Trình HP5 Python</option>
            <option value="Thế Giới Vạn Vật Thông Minh HP1">Thế Giới Vạn Vật Thông Minh HP1</option>
            <option value="Digi Multimedia Canva HP1">Digi Multimedia Canva HP1</option>
          </select>
        </div>

        <div class="form-group">
          <label class="label" for="haoHung">Con có hào hứng không?</label>
          <textarea class="textarea" id="haoHung" placeholder="VD: Con rất hào hứng và tập trung trong suốt buổi học..."
            required></textarea>
        </div>

        <div class="form-group">
          <label class="label" for="banKhoan">PH băn khoăn / thích thú điều gì?</label>
          <textarea class="textarea" id="banKhoan"
            placeholder="VD: Phụ huynh quan tâm về lộ trình học, con thích thú với phần thực hành..."
            required></textarea>
        </div>

        <div class="form-group">
          <label class="label" for="baoPhi">Báo phí như thế nào?</label>
          <textarea class="textarea" id="baoPhi" placeholder="VD: PH đã được tư vấn về học phí, gói học..."
            required></textarea>
        </div>

        <div class="form-group">
          <label class="label" for="lopHoc">Lớp có thể học / thời gian rảnh</label>
          <textarea class="textarea" id="lopHoc" placeholder="VD: Thứ 3, 5 từ 17h-18h30 hoặc Thứ 7, CN sáng..."
            required></textarea>
        </div>

        <div class="btn-group">
          <button type="submit" class="btn btn-primary">Tạo nội dung</button>
          <button type="button" id="resetBtn" class="btn">Làm mới form</button>
        </div>
      </form>
    </div>

    <!-- Result card -->
    <div class="card" id="resultCard" style="display: none;">
      <h2>Nội dung báo cáo</h2>
      <div class="output" id="output"></div>
      <div class="btn-group" style="margin-top: 24px;">
        <button id="copyBtn" class="btn btn-primary">Copy nội dung</button>
        <button id="editBtn" class="btn">Chỉnh sửa</button>
      </div>
      <div class="success-msg" id="successMsg">✓ Đã copy vào clipboard!</div>
    </div>
  </div>

  <script>
    const form = document.getElementById('reportForm');
    const outputDiv = document.getElementById('output');
    const resultCard = document.getElementById('resultCard');
    const copyBtn = document.getElementById('copyBtn');
    const resetBtn = document.getElementById('resetBtn');
    const editBtn = document.getElementById('editBtn');
    const successMsg = document.getElementById('successMsg');

    // Load saved data from localStorage on page load
    window.addEventListener('DOMContentLoaded', function () {
      const savedData = localStorage.getItem('formData');
      if (savedData) {
        const data = JSON.parse(savedData);
        Object.keys(data).forEach(key => {
          const input = document.getElementById(key);
          if (input) {
            let val = data[key];
            // Convert stored ISO date (yyyy-mm-dd) to DD/MM/YYYY for ngaySinh field
            if (key === 'ngaySinh' && val && /^\d{4}-\d{2}-\d{2}$/.test(val)) {
              const [y, m, d] = val.split('-');
              val = `${d}/${m}/${y}`;
            }
            input.value = val;
          }
        });
      }
    });

    // Save form data to localStorage on input
    form.addEventListener('input', function () {
      const formData = {};
      const inputs = form.querySelectorAll('input, select, textarea');
      inputs.forEach(input => {
        formData[input.id] = input.value;
      });
      localStorage.setItem('formData', JSON.stringify(formData));
    });

    // Auto-format ngaySinh as DD/MM/YYYY while typing and validate on blur
    const ngaySinhInput = document.getElementById('ngaySinh');
    if (ngaySinhInput) {
      ngaySinhInput.addEventListener('input', function (e) {
        const v = e.target.value.replace(/\D/g, '').slice(0, 8);
        let out = v;
        if (v.length >= 5) out = v.replace(/(\d{2})(\d{2})(\d{4})/, '$1/$2/$3');
        else if (v.length >= 3) out = v.replace(/(\d{2})(\d{1,2})/, '$1/$2');
        e.target.value = out;
      });

      ngaySinhInput.addEventListener('blur', function (e) {
        const val = e.target.value;
        const pattern = /^([0-9]{2})\/([0-9]{2})\/([0-9]{4})$/;
        if (val && !pattern.test(val)) {
          e.target.setCustomValidity('Vui lòng nhập ngày theo định dạng DD/MM/YYYY');
        } else {
          e.target.setCustomValidity('');
        }
      });
    }

    form.addEventListener('submit', function (e) {
      e.preventDefault();

      const hoTen = document.getElementById('hoTen').value.trim();
      const ngaySinh = document.getElementById('ngaySinh').value;
      const truong = document.getElementById('truong').value.trim();
      const testMon = document.getElementById('testMon').value;
      const gvTest = document.getElementById('gvTest').value;
      const gvDanhGia = document.getElementById('gvDanhGia').value;
      const haoHung = document.getElementById('haoHung').value.trim();
      const banKhoan = document.getElementById('banKhoan').value.trim();
      const baoPhi = document.getElementById('baoPhi').value.trim();
      const lopHoc = document.getElementById('lopHoc').value.trim();

      // Parse and validate date in DD/MM/YYYY
      let formattedDate = '';
      if (ngaySinh) {
        const parts = ngaySinh.split('/');
        if (parts.length === 3) {
          const day = parseInt(parts[0], 10);
          const month = parseInt(parts[1], 10) - 1;
          const year = parseInt(parts[2], 10);
          const dateObj = new Date(year, month, day);
          if (!isNaN(dateObj) && dateObj.getFullYear() === year && dateObj.getMonth() === month && dateObj.getDate() === day) {
            formattedDate = `${String(day).padStart(2, '0')}/${String(parts[1]).padStart(2, '0')}/${year}`;
          } else {
            formattedDate = ngaySinh; // fallback to raw input
          }
        } else {
          formattedDate = ngaySinh;
        }
      }

      const content = `Họ tên bé: ${hoTen}
Ngày tháng năm sinh: ${formattedDate}
Trường đang học: ${truong}
Test môn gì: ${testMon}
GV test: ${gvTest}
GV đánh giá bé học được môn gì bắt đầu từ HP mấy: ${gvDanhGia}
Con có hào hứng không: ${haoHung}
PH băn khoăn điều gì? Thích thú điều gì không: ${banKhoan}
Báo phí như thế nào: ${baoPhi}
Lớp có thể học hoặc thời gian rảnh của bạn: ${lopHoc}`;

      outputDiv.textContent = content;
      resultCard.style.display = 'block';

      // Smooth scroll to result
      resultCard.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    });

    copyBtn.addEventListener('click', function () {
      navigator.clipboard.writeText(outputDiv.textContent).then(() => {
        successMsg.classList.add('show');
        setTimeout(() => {
          successMsg.classList.remove('show');
        }, 3000);
      }).catch(() => {
        alert('Không thể copy, vui lòng thử thủ công.');
      });
    });

    resetBtn.addEventListener('click', function () {
      if (confirm('Bạn có chắc muốn xóa toàn bộ dữ liệu form?')) {
        form.reset();
        localStorage.removeItem('formData');
        resultCard.style.display = 'none';
      }
    });

    editBtn.addEventListener('click', function () {
      window.scrollTo({ top: 0, behavior: 'smooth' });
      document.getElementById('hoTen').focus();
    });
  </script>
<script>
  // === DANH SÁCH GỢI Ý CHO TỪNG FIELD ===
  const suggestions = {
    haoHung: [
      "Hào hứng",
      "Không thích lắm",
      "Tập trung tốt",
      "Không tập trung",
      "Tương tác tốt với giáo viên",
      "Rụt rè",
      "Chủ động đặt câu hỏi",
      "Tiếp thu tốt",
      "Tiếp thu khá",
      "Tư duy tốt",
      "Thao tác máy tính tốt",
      "Thao tác máy tính cần cải thiện"
    ],
    banKhoan: [
      "Phụ huynh quan tâm",
      "Phụ huynh không thật sự quan tâm",
      "Học phí cao hơn khả năng chi trả",
      "Chờ đến thời điểm phù hợp hơn mới đăng ký",
      "Muốn ghi danh lộ trình ngắn",
      "So sánh với trung tâm khác",
      "Thời gian học chưa phù hợp cần sắp xếp lại",
      "Học nhiều môn sợ quá tải",
      "Gia đình chưa sắp xếp được việc đưa đón",
      "Cần tham khảo thêm ý kiến bé",
      "Cần tham khảo thêm ý kiến gia đình",
      "Sợ bé nản, bỏ ngang",
      "Sợ bé còn nhỏ chưa tập trung",
      "Phản vấn học online hay off",
      "Bế đặc biệt tư vấn coaching 1-1",
      "Bế đặc biệt tư vấn 1hp không cam kết",
      "Học offset học phần 1 4 buổi coaching offline bao phí"
    ],
    baoPhi: [
      "Đã tư vấn chi tiết các gói học phí, phụ huynh đang cân nhắc và sẽ quyết định trong vài ngày tới.",
      "PH đã được báo phí đầy đủ các gói, đồng ý mức học phí và dự kiến đăng ký trong tuần này.",
      "Đã gửi bảng học phí chi tiết qua Zalo, phụ huynh sẽ trao đổi thêm với gia đình.",
      "Phụ huynh thấy học phí hợp lý, đang xem lịch để chọn lớp phù hợp.",
      "Đã báo phí và ưu đãi đăng ký sớm, PH rất quan tâm và hỏi thêm về chính sách hoàn phí.",
      "PH đã hiểu rõ cấu trúc học phí, đang tính toán gói phù hợp với điều kiện gia đình.",
      "Đã tư vấn học phí, phụ huynh hài lòng và hẹn cuối tuần sẽ chốt đăng ký."
    ]
  };

  // === AUTOCOMPLETE ĐÃ SỬA LỖI - NỐI BẰNG DẤU PHẨY, KHÔNG THỪA, KHÔNG MẤT CHỮ ===
  function createAutocomplete(textareaId, suggestionsList) {
    const textarea = document.getElementById(textareaId);
    let dropdown = document.getElementById(`autocomplete-${textareaId}`);
    let items = [];
    let selectedIndex = -1;

    if (!dropdown) {
      dropdown = document.createElement('div');
      dropdown.id = `autocomplete-${textareaId}`;
      dropdown.className = 'autocomplete-dropdown';
      textarea.parentNode.style.position = 'relative';
      textarea.parentNode.appendChild(dropdown);
    }

    // Lấy thông tin từ đang gõ trước con trỏ
    function getCurrentWordInfo() {
      const value = textarea.value;
      const cursorPos = textarea.selectionStart;
      const textBefore = value.substring(0, cursorPos);
      const textAfter = value.substring(cursorPos);

      // Tìm từ cuối cùng trước con trỏ (không tính dấu cách hoặc phẩy)
      const match = textBefore.match(/([^,\s][^,\s]*)$/);
      const currentWord = match ? match[0].toLowerCase() : '';
      const startPos = match ? cursorPos - match[0].length : cursorPos;

      return { currentWord, startPos, textBefore, textAfter };
    }

    function showDropdown(filtered) {
      dropdown.innerHTML = '';
      items = filtered;

      if (filtered.length === 0) {
        dropdown.style.display = 'none';
        return;
      }

      filtered.forEach((suggestion, index) => {
        const item = document.createElement('div');
        item.className = 'autocomplete-item';
        item.textContent = suggestion;
        item.addEventListener('click', () => selectSuggestion(index));
        item.addEventListener('mousemove', () => highlightItem(index));
        dropdown.appendChild(item);
      });

      selectedIndex = 0;
      highlightItem(0);
      dropdown.style.display = 'block';
    }

    function hideDropdown() {
      dropdown.style.display = 'none';
      selectedIndex = -1;
    }

    function highlightItem(index) {
      const allItems = dropdown.querySelectorAll('.autocomplete-item');
      allItems.forEach((el, i) => el.classList.toggle('highlighted', i === index));
      selectedIndex = index;
    }

    function selectSuggestion(index) {
      if (index < 0 || index >= items.length) return;
      const suggestion = items[index];
      const { currentWord, startPos, textBefore, textAfter } = getCurrentWordInfo();

      // Cắt bỏ phần từ đang gõ dở (nếu có khớp)
      let leftPart = textBefore.substring(0, startPos);

      // Trim phía cuối leftPart để chuẩn bị thêm dấu phẩy
      leftPart = leftPart.trim();

      // Nếu đã có nội dung → thêm dấu phẩy + khoảng trắng (chỉ khi chưa kết thúc bằng phẩy)
      if (leftPart.length > 0) {
        if (!leftPart.endsWith(',')) {
          leftPart += ',';
        }
        leftPart += ' '; // thêm khoảng trắng sau phẩy
      }

      // Ghép lại: phần trái + gợi ý mới + phần phải
      textarea.value = leftPart + suggestion + textAfter;

      // Đặt con trỏ ngay sau gợi ý vừa thêm
      const newCursorPos = leftPart.length + suggestion.length;
      textarea.focus();
      textarea.setSelectionRange(newCursorPos, newCursorPos);

      // Trigger input để lưu và cập nhật lại dropdown nếu cần
      textarea.dispatchEvent(new Event('input'));

      hideDropdown();
    }

    function filterSuggestions() {
      const { currentWord } = getCurrentWordInfo();
      if (currentWord === '') {
        hideDropdown();
        return;
      }

      const filtered = suggestionsList.filter(s =>
        s.toLowerCase().includes(currentWord)
      );

      showDropdown(filtered);
    }

    // Events
    textarea.addEventListener('input', filterSuggestions);
    textarea.addEventListener('keydown', function (e) {
      if (!dropdown.style.display || dropdown.style.display === 'none') return;

      if (e.key === 'ArrowDown') {
        e.preventDefault();
        selectedIndex = (selectedIndex + 1) % items.length;
        highlightItem(selectedIndex);
      } else if (e.key === 'ArrowUp') {
        e.preventDefault();
        selectedIndex = (selectedIndex - 1 + items.length) % items.length;
        highlightItem(selectedIndex);
      } else if (e.key === 'Enter' || e.key === 'Tab') {
        e.preventDefault();
        selectSuggestion(selectedIndex >= 0 ? selectedIndex : 0);
      } else if (e.key === 'Escape') {
        hideDropdown();
      }
    });

    document.addEventListener('click', (e) => {
      if (!textarea.contains(e.target) && !dropdown.contains(e.target)) {
        hideDropdown();
      }
    });

    textarea.addEventListener('focus', filterSuggestions);
  }

  // === STYLE GIỮ NGUYÊN ===
  const style = document.createElement('style');
  style.textContent = `
    .autocomplete-dropdown {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: #fff;
      border: 1px solid #d4d4d4;
      border-radius: 8px;
      max-height: 240px;
      overflow-y: auto;
      z-index: 1000;
      box-shadow: 0 8px 24px rgba(0,0,0,0.12);
      display: none;
      margin-top: 4px;
    }
    .autocomplete-item {
      padding: 12px 14px;
      cursor: pointer;
      font-size: 14px;
      border-bottom: 1px solid #eee;
    }
    .autocomplete-item:hover,
    .autocomplete-item.highlighted {
      background: #f0f8ff;
      color: #000;
      font-weight: 500;
    }
    .autocomplete-item:last-child {
      border-bottom: none;
    }
  `;
  document.head.appendChild(style);

  // === KHỞI TẠO ===
  createAutocomplete('haoHung', suggestions.haoHung);
  createAutocomplete('banKhoan', suggestions.banKhoan);
  createAutocomplete('baoPhi', suggestions.baoPhi);
</script>
</body>

</html>